***********************************
*     									 *
* NEW131.PRG REI - IMPRIMR        *
*											 *
***********************************
PRIVATE VCOND,VCOND1,VCAMPOS[7],VCABEC[7]
SAVE SCREEN TO VTELA_REI
DO WHILE .T.
	VDE = DATE()
	VATE = DATE()+2
	VEMP = SPACE(7)
	VPLACA = SPACE(7)
	@ 10,10 CLEAR TO 14,70
	@ 10,10 TO 14,70 DOUBLE
	SET KEY -1 TO E
	@ 11,11 SAY "DE " GET VDE
	@ 11,30 SAY "ATE " GET VATE
	@ 13,11 SAY "Placa do Motiqueiro " GET VPLACA PICT "@!"
	READ
	SET KEY -2 TO
	VEMP = VPLACA
	SAVE SCREEN TO VG

	IF LASTKEY()=27
		EXIT
	ENDIF
	IF VEMP = SPACE(40)
		EXIT
	ENDIF
	USE VENDAS
	GO TOP
		
*   VCOND = "(NOME = ALLTRIM(VEMP) .AND. VDE>=DATA .AND. VATE<=DATA .OR. (' '+ALLTRIM(VEMP)+' ')$(' '+ALLTRIM(NOME)+' '))  .AND. VDE>=DATA .AND. VATE<=DATA"
*   VCOND = "(PLACA = ALLTRIM(VEMP) .OR. (' '+ALLTRIM(VEMP)+' ')$(' '+ALLTRIM(PLACA)+' '))"
    VCOND = "PLACA = VEMP"

    VCOND1 = "VDE<=DATA .AND.VATE>=DATA "

 	COPY TO VENDAS1 FOR &VCOND1 .AND. &VCOND

	USE VENDAS1
	IF EOF()
		MSGBOX("NÆo a Produtos a Ser Impresso!")
		EXIT
	ENDIF
	CLEAR
	GO TOP
	VCABEC[1] = "MOTO"
	VCABEC[2] = "PLACA"
	VCABEC[3] = "DES"
	VCABEC[4] = "PRODUTO"
	VCABEC[5] = "DATA"
	VCABEC[6] = "VALORP"
	VCABEC[7] = "NOME"

	VCAMPOS[1] = "MOTOQUEIRO"
	VCAMPOS[2] = "PLACA"
	VCAMPOS[3] = "DESCRICAO"
	VCAMPOS[4] = "CODIGO"	
	VCAMPOS[5] = "DATA"	
	VCAMPOS[6] = "VALOR"	
	VCAMPOS[7] = "EMPRESA"
	USE VENDAS1
	VTOTAL = 0
	DO WHILE !EOF()
		VTOTAL = VTOTAL + VALORP
		SKIP
	ENDDO
	GO TOP
	@ 24,55 say "Total ....: "+STR(VTOTAL)
	@ 00,00 TO 23,80 DOUBLE
	DBEDIT(01,01,22,77,VCABEC,0,0,VCAMPOS)
	RESTORE SCREEN FROM VG
	IF LASTKEY()#27
		SAVE SCREEN TO VTELA_IM
		VEMP = NOME
		@ 16,40 CLEAR TO 19,65
		@ 16,40 TO 19,65
		CENTRA(17,40,65,"Deseja Imprimir?")
		@ 18,45 PROMPT " SIM "
		@ 18,53 PROMPT " NAO "
		MENU TO VOP
		IF VOP = 1
			DO IMPR	
			USE CONFIG
			VCABECA1= CABECA1
			VCABECA2= CABECA2
			VCABECA3= CABECA3
			VRODAPE1 = RODAPE1
			VRODAPE2 = RODAPE2
			VRODAPE3 = RODAPE3
			IF LASTKEY()#27
		  		SET PRINTER TO PAPEL
				SET DEVI TO PRINT
				@ PROW(),PCOL() SAY CHR(27)+CHR(48)+CHR(15)
				@ PROW()+1 ,01 SAY CHR(12)+VCABECA1+CHR(20)
				@ PROW()+2, 01 SAY VCABECA2
				@ PROW()+2, 01 SAY VCABECA3   
				@ PROW()+2,01 SAY "RECIBO EMPRESA"
			   @ PROW()+2,01 SAY "DE  "+DTOC(VDE)+"  ATE  "+DTOC(VATE)
				@ PROW()  ,25 SAY DATE()
				@ PROW()  ,45 SAY TIME()
				@ PROW()+2,01 SAY VEMP
				@ PROW()+2,01 SAY REPLICATE("=",60)
				X=1
			   USE VENDAS1
				GO TOP
				VT=0
				DO WHILE .NOT. EOF()
					VDESCRICAO=DES
					VVALOR=VALORP
					VDATA1=DATA
					@ PROW()+2,01 SAY SUBS(VDESCRICAO,1,20)
					@ PROW()  ,25 SAY VVALOR PICTURE "@E 99,999.99"
					X=X+1
					VT=VT+VALORP
					SKIP
				ENDDO
				GO TOP
				VL = VALOR
				@ PROW()+1,01 SAY REPLICATE("-",60)
				@ PROW()+2,01   SAY "VALOR TOTAL..... R$ "
				@ PROW(),PCOL()+5 SAY VL PICTURE "@E 99,999.99"
*				@ PROW()+2,01   SAY "# # # # DEVOLUCAO.......: "
*				@ PROW(),PCOL()+2 SAY VDATA
				@ PROW()+4,02 SAY "CLIENTE:" 
				@ PROW()+2,00 SAY "____________________________________"
				@ PROW()+3,00 SAY VRODAPE1
				@ PROW()+2,00 SAY VRODAPE2
				@ PROW()+2,00 SAY VRODAPE3
				@ PROW()+40,00 SAY " "  
				SET DEVICE TO SCREEN
				SWPRUNCMD("COPY PAPEL.PRN LPT1",0,"","")					
			ENDIF
		ENDIF
		RESTORE SCREEN FROM VTELA_IM
	ENDIF
ENDDO
RESTORE SCREEN FROM VTELA_REI
RETURN